<script>
  var pswpElement = document.querySelectorAll('.pswp')[0];

  // build items array
  var items = [
      <% @images.each do |image| %>
        {
            src: "<%= asset_path(image.filename, type: :image, skip_pipeline: true)%>",
            w: <%= image.width %>,
            h: <%= image.height %>
        },
      <% end %>
  ];

  // define options (if needed)
  var options = {
      index: 0, // start at first slide
      preload: [2,2],
      barsSize: {top: 0, bottom: 0},
      shareEl: false
  };
</script>

<h2><%= @title %></h2>

<% if @images.length > 0 %>
  <% @images.each_with_index do |i,ind| %>
    <div class="gallery">
      <%= link_to post_path(i), target: :_blank do %>
        <%= image_tag(i.thumbnail_path, title: i.tag_summary, width: 90, height: 90, skip_pipeline: true) %>
      <% end %>
      <%= content_tag(:div, '&#9658;'.html_safe, class: 'desc', onclick: "options['index']=#{ind};gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, options);gallery.init();return false;") %>
    </div>
  <% end %>
<% else %>
  <h3>Nothing here</h3>
<% end %>
